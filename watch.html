<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nexus Files</title>

<link rel="stylesheet" href="https://cdn.plyr.io/3.6.12/plyr.css" />
<script src="https://cdn.plyr.io/3.6.12/plyr.polyfilled.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
  body {
    font-family: 'Roboto', sans-serif;
    margin: 0;
    padding: 0;
    transition: background-color 0.3s, color 0.3s;
  }
  body.dark-mode {
    background-color: #121212;
    color: #bbb;
  }
  body.light-mode {
    background-color: #ffffff;
    color: #121212;
  }
  header {
    background-color: #222;
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #ffffff;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  header a {
    font-size: 20px;
    margin: 0;
    font-weight: bold;
    color: white;
    text-decoration: none;
  }
  .headerIcon {
    display: flex;
    gap: 10px;
    align-items: center;
  }
  .mode-toggle, .searchbtn {
    background-color: #444;
    border: none;
    border-radius: 50%;
    width: 38px;
    height: 38px;
    color: #ffffff;
    font-size: 20px;
    cursor: pointer;
    transition: transform 0.2s ease-in-out, background-color 0.3s;
  }
  .mode-toggle:hover, .searchbtn:hover {
    transform: scale(1.1);
    background-color: #555;
  }
  .download-btn {
    display: none;
  }
  #downloadOptions {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 20px;
    flex-direction: column;
  }
  .quality-block {
    background: #191919;
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 20px;
    display: flex;
    gap: 16px;
    align-items: center;
    flex-wrap: wrap;
  }
  .quality-img {
    max-width: 120px;
    border-radius: 6px;
    background: #111;
  }
  .quality-info {
    flex: 1;
    min-width: 180px;
  }
  .download-link {
    font-size: 12px;
    color: #ffa500;
    margin-bottom: 8px;
    word-break: break-all;
  }
  .download-btn {
    padding: 9px 24px;
    background: #35b535;
    color: #fff;
    border: none;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 8px;
    margin-bottom: 4px;
  }
  .download-btn:hover {
    background: #219421;
  }
  @media (max-width: 600px) {
    #downloadOptions {
      flex-direction: column;
      align-items: flex-start;
    }
    .quality-block {
      flex-direction: column;
      align-items: flex-start;
    }
    .quality-img {
      max-width: 100%;
    }
  }
</style>
<script src="https://fpyf8.com/88/tag.min.js" data-zone="149511" async data-cfasync="false"></script>
</head>

<body class="light-mode">

<header>
  <a href="/">Nexus Files</a>
  <div class="headerIcon">
    <button class="searchbtn" onclick="window.location.href='src/template/search.html';">
      <i class="fas fa-search"></i>
    </button>
    <button class="mode-toggle" onclick="toggleMode()">
      <i class="fas fa-sun"></i>
    </button>
  </div>
</header>

<div class="main-container" style="padding: 10px;">
  <div id="movieImages"></div>
  <div class="container2" style="display: flex; flex-direction: column;">
    <div id="posterDetails" style="margin-right: 20px; background-color: #000; padding: 20px; border-radius: 10px 10px 0px 0px; margin-right: 0; margin-bottom: 0;">
      <!-- Images and details will be injected here -->
    </div>
    <div id="movieInfo" class="detailsContainer" style="margin-right: 20px; background-color: #000; padding: 20px; color: #fff; border-radius: 0px 0px 10px 10px; margin-right: 0; margin-bottom: 0;">
      <!-- IMDb data will be injected here -->
    </div>
  </div>
  <div id="movieStoryline"></div>
  <div id="movieScreenshots"></div>
  <div id="downloadOptions"></div>
</div>

<footer>
  <div class="footer" style="margin-top: 40px; border-radius: 20px 20px 0px 0px; box-shadow: rgba(0, 0, 0, 0.1) 0px 5px 35px; box-sizing: border-box; padding:15px; position: relative; left:0; bottom:0; width:100%; text-align: center; background-color: #222; font-size: 14px;  color: #fff;">
    <div class="made-with-love" style="color: #ff9800; margin: 5px 0;">Made with ❤ by TechnicalBichu</div>
    <div class="social-links" style="margin-top: 10px; margin-bottom: 10px;">
      <a href="https://github.com/" target="_blank" style="margin: 0 10px; color: #fff; text-decoration: none; font-size: 16px;">
        <i class="fab fa-github"></i>
      </a>
      <a href="https://twitter.com/" target="_blank" style="margin: 0 10px; color: #fff; text-decoration: none; font-size: 16px;">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://linkedin.com/" target="_blank" style="margin: 0 10px; color: #fff; text-decoration: none; font-size: 16px;">
        <i class="fab fa-linkedin"></i>
      </a>
    </div>
    <div>
      © <span id='getYear'></span> ‧
      <bdi>
        <a href='https://t.me/TechnicalBichu' style="color:red; text-decoration: none;">TechnicalBichu</a>
      </bdi>‧ All rights reserved.
    </div>
  </div>
</footer>

<script>
  // YEAR IN FOOTER
  document.getElementById('getYear').textContent = new Date().getFullYear();

  // DARK/LIGHT MODE TOGGLE
  function toggleMode() {
    const body = document.body;
    const modeButton = document.querySelector('.mode-toggle i');
    if (body.classList.contains('dark-mode')) {
      body.classList.replace('dark-mode', 'light-mode');
      modeButton.classList.replace('fa-moon', 'fa-sun');
    } else {
      body.classList.replace('light-mode', 'dark-mode');
      modeButton.classList.replace('fa-sun', 'fa-moon');
    }
  }

  // --------- MAIN SCRIPT USING API ---------
  async function loadMovie() {
    const apiUrl = "https://mymoviesclan-demo-api.vercel.app/api/files";
    const urlParams = new URLSearchParams(window.location.search);
    const title2 = decodeURIComponent(urlParams.get('title') || '');

    // Fetch API data
    const res = await fetch(apiUrl);
    const data = await res.json();

    // Find movie by title (case-insensitive, supports both 'title', 'Title2', 'Title3')
    const movie = Array.isArray(data.results)
      ? data.results.find(m =>
          [m.title, m.Title2, m.Title3].some(t => t && t.toLowerCase() === title2.toLowerCase())
        )
      : data.results;

    if (!movie) {
      document.getElementById('movieInfo').innerHTML = "<b>Movie not found.</b>";
      return;
    }

    // 1. IMAGES
    let imagesHTML = `<div class="images" style="display:flex;gap:20px;margin-bottom:20px;flex-wrap:wrap;">`;
    // Poster from imdbData
    if (movie.imdbData?.poster)
      imagesHTML += `<img src="${movie.imdbData.poster}" alt="IMDB Poster" style="max-width:200px;border-radius:8px;background:#111;">`;
    // Thumbnails from all qualities
    if (Array.isArray(movie.sources)) {
      movie.sources.forEach(q => {
        if (q.thumbnail) {
          imagesHTML += `<img src="${q.thumbnail}" alt="Thumbnail" style="max-width:120px;border-radius:8px;background:#111;">`;
        }
      });
    }
    imagesHTML += `</div>`;
    document.getElementById('movieImages').innerHTML = imagesHTML;

    // 2. IMDb DATA (in details area)
    let imdb = movie.imdbData || {};
    document.getElementById('posterDetails').innerHTML =
      `<h1 style="font-size: 30px;">Download ${movie.Title3 || imdb.title || movie.Title2 || movie.title || ''} Web-DL Dual Audio movie {${movie.sources?.[0]?.language || 'Unknown'}-${movie.sources?.[0]?.secondaryLanguages || ''}} +EngSubtitle 480p [500MB] 720p [1.2 GB] 1080p [2.6GB]</h1>`;

    document.getElementById('movieInfo').innerHTML =
      `<div style="color: #C1C1C1;"><h2 style=" color: #C1C1C1; font-size: 24px; margin-top: 0;">${movie.Title3 || imdb.title || movie.Title2 || movie.title || ''} (${imdb.year || movie.year || ''})</h2></div>
      <p style="color: #fff; margin: 0;">${imdb.runtime || ''} | ${imdb.Genre || ''} | ${imdb.releaseDate || ''} | (${imdb.country || ''})</p><br>
      <p style="margin: 0;"><strong style="color: #fff;">Rating:</strong> <span style="color: #C1C1C1; font-weight: bold;"> ${imdb.imdbRating || ''} </span> <span style="color: #fff;">/10</span> <span style="color: #888888;">from ${imdb.imdbVotes || ''} users</span></p><br>
      <p style="margin: 0;"><strong style="color: #fff;">Director:</strong> <span style="color: #C1C1C1;"> ${imdb.director || ''} </span></p>
      <p style="margin: 0;"><strong style="color: #fff;">Writer:</strong> <span style="color: #C1C1C1;"> ${imdb.writer || ''} </span></p>
      <p style="margin: 0;"><strong style="color: #fff;">Stars:</strong> <span style="color: #C1C1C1;"> ${imdb.actors || ''} </span></p>`;

    // Storyline
    document.getElementById('movieStoryline').innerHTML = `
      <p>
        <span style="background: 0px 0px; color: teal; font-family: arial; font-size: 16px;">
          <span class="quality" style="background: rgb(249, 163, 2); border-radius: 3px; color: white; display: inline-block; margin-left: 2px; padding: 2px 5px; text-transform: uppercase;">
            <strong>STORYLINE :-</strong>
          </span>
        </span>
      </p>
      <p>${imdb.plot || ''}</p>
    `;

    // Screenshots (reuse images for now)
    document.getElementById('movieScreenshots').innerHTML = `
      <p>
        <span style="background: 0px 0px; color: teal; font-family: arial; font-size: 16px;">
          <span class="quality" style="background: rgb(34, 34, 34); border-radius: 3px; color: white; display: inline-block; margin-left: 2px; padding: 2px 5px; text-transform: uppercase;">
            <strong>SCREENSHOTS :-</strong>
          </span>
        </span>
      </p>
    `;

    // 3. QUALITIES
    let qualitiesHTML = `<p>
      <span style="background: 0px 0px; color: teal; font-family: arial; font-size: 16px;">
        <span class="quality" style="background: rgb(34, 34, 34); border-radius: 3px; color: white; display: inline-block; margin-left: 2px; padding: 2px 5px; text-transform: uppercase;">
          <b>DOWNLOAD LINKS :-</b>
        </span>
      </span>
    </p>`;

    if (Array.isArray(movie.sources)) {
      movie.sources.forEach(q => {
        // Remove domain from download link
        let shortLink = q.downloadLink?.replace(/^https:\/\/watchoflix\.koyeb\.app/, "") || "";
        qualitiesHTML += `
          <div class="quality-block">
            ${q.thumbnail ? `<img class="quality-img" src="${q.thumbnail}" alt="Quality Thumbnail">` : ""}
            <div class="quality-info">
              <div class="download-link">${shortLink}</div>
              <div><b>Quality:</b> ${q.quality || ""}</div>
              <div><b>File Size:</b> ${q.fileSize || ""}</div>
              <button class="download-btn" onclick="window.open('${q.downloadLink}','_blank')">Download</button>
            </div>
          </div>
        `;
      });
    }
    document.getElementById('downloadOptions').innerHTML = qualitiesHTML;
  }

  // Load movie data after DOM is ready
  document.addEventListener("DOMContentLoaded", loadMovie);
</script>
<script src="auth.js"></script>
</body>
</html>